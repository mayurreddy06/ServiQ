<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Map and Form App</title>
  <!-- Mapbox CSS -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
  <link href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.css" rel="stylesheet">
  <!-- CSS file -->
  <link rel="stylesheet" href="styles.css">
  <!-- Google Places API -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAwHozpYoJS8xgURnkkICo7L0vw8xW2Oak&libraries=places"></script>
</head>
<body>
  <div class="container">
    <div class="form-container">
      <h2>Store Discount Form</h2>
      <form id="discount-form">
        <label for="autocomplete">Store Location:</label>
        <input type="text" id="autocomplete" name="store-location" placeholder="Enter a location" required>
        
        <label for="select"> Discount Type: </label>
        <select name="question" id="select-discount">
            <option value="q1"> Specific Percentage </option>
            <option value="q2"> Buy One Get One Free </option>
            <option value="q3"> Get One $5 Off </option>
        </select>

        <label for="discount">Discount (%):</label>
        <input type="number" id="discount" name="discount" placeholder="Enter discount percentage" required>

        <label for="expiration">Expiration Date (optional)</label>
        <input type= "date" id="expiration" name = "expiration" placeholder="Enter date">
        <button type="submit">Submit</button>
      </form>

      <!-- Display coordinates -->
      <div id="coordinates" style="margin-top: 20px;"></div>
    </div>
    <!-- Map container -->
    <div id="map"></div>
    <!-- Custom container for the search bar -->
    <div id="geocoder-container"></div>
  </div>

  <!-- Include Mapbox JS -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <!-- Include Mapbox Geocoder JS -->
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.2/mapbox-gl-geocoder.min.js"></script>
  
  <!-- Link to external JS file -->
  <script src="script.js"></script>
  
  <script>
    // Set the Mapbox access token
    mapboxgl.accessToken = 'YOUR_ACCESS_TOKEN_HERE'; // Replace with your access token

    // Initialize the map
    const map = new mapboxgl.Map({
      container: 'map', // ID of the container
      style: 'mapbox://styles/mapbox/streets-v11', // Map style
      center: [-74.006, 40.7128], // Initial center [longitude, latitude]
      zoom: 12 // Initial zoom level
    });

    // Add Navigation Controls
    map.addControl(new mapboxgl.NavigationControl(), 'top-right');

    // Add Fullscreen Control
    map.addControl(new mapboxgl.FullscreenControl(), 'top-right');

    // Add Geocoder (Search Bar)
    const geocoder = new MapboxGeocoder({
      accessToken: mapboxgl.accessToken,
      mapboxgl: mapboxgl,
      placeholder: 'Search for places...', // Placeholder text
    });

    // Append Geocoder to the custom container
    document.getElementById('geocoder-container').appendChild(geocoder.onAdd(map));

    // Handle Search Bar Results
    geocoder.on('result', (event) => {
      console.log('Search result:', event.result);
      const coords = event.result.geometry.coordinates;
      // Add a marker at the searched location
      new mapboxgl.Marker().setLngLat(coords).addTo(map);
    });

    // Event Listener for Map Click
    map.on('click', (event) => {
      const { lng, lat } = event.lngLat;
      console.log(`Clicked coordinates: Longitude: ${lng}, Latitude: ${lat}`);
    });

    // Initialize Google Places Autocomplete
    function initAutocomplete() {
      const input = document.getElementById('autocomplete');
      const autocomplete = new google.maps.places.Autocomplete(input);

      autocomplete.addListener('place_changed', function() {
        const place = autocomplete.getPlace();
        
        if (place.geometry && place.geometry.location) {
          const lat = place.geometry.location.lat();
          const lng = place.geometry.location.lng();
          // Display coordinates
          document.getElementById('coordinates').innerHTML = 
            `<p>Latitude: ${lat}</p><p>Longitude: ${lng}</p>`;
          
          console.log('Coordinates:', { lat, lng });
        } else {
          console.log('No coordinates found for this place');
        }
      });
    }

    window.addEventListener('load', initAutocomplete);
  </script>
</body>
</html>
