<!DOCTYPE html>
<html>
<head>
    <title>Sign Up</title>
    <link rel="stylesheet" href="/css/signup.css">
    <script>
        // Handle form submission with AJAX to properly handle verification redirect
        document.getElementById('agency-register-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const form = e.target;
            const formData = new FormData(form);
            const submitButton = document.getElementById('submit-button');
            
            submitButton.disabled = true;
            submitButton.textContent = 'Creating account...';
            
            try {
                const response = await fetch(form.action, {
                    method: 'POST',
                    body: formData
                });
                
                if (response.redirected) {
                    // If registration is successful, redirect to verification page
                    window.location.href = response.url;
                } else {
                    // Handle errors
                    const result = await response.json();
                    if (result.error) {
                        alert(result.error);
                    }
                    submitButton.disabled = false;
                    submitButton.textContent = 'Sign up';
                }
            } catch (error) {
                console.error('Error:', error);
                submitButton.disabled = false;
                submitButton.textContent = 'Sign up';
                alert('An error occurred. Please try again.');
            }
        });
    </script>
</head>
<body>
    <div class="form-box">
        <h2 class="admin-text">Create Agency Account</h2>
        <p class="subtitle">to continue</p>

        <form id="agency-register-form" action="/auth/register" method="POST">
            <div class="signup-info">
                <input type="text" placeholder="Agency name" id="agency-name" name="agencyName" required>
                <input type="email" placeholder="email" id="agency-email" name="email" required>
                <input type="text" placeholder="Agency description" id="agency-desc" name="agencyDesc" required>
                <input type="password" placeholder="Password" id="agency-password" name="password" required>
                <input type="password" placeholder="Confirm" id="agency-reenter-password" name="password2" required>
                <p class="help-text">Use 6 or more characters with a number and symbol</p>
            </div>
            <div class="actions">
                <button type="submit" id="submit-button">Sign up</button>
            </div>
            <div class="error-message">
                <% if (typeof (locals.registerError) !== "undefined") { %>
                <p id="error-tag" style="color: red"><%= locals.registerError %></p>
                <% } %>
            </div>
        </form>
        
        <div class="login-link">
            Already have an account? <a href="/auth/login">Log in</a>
        </div>
    </div>
</body>
</html>